<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Dashboard PetFeeder</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #111111;
      --card-bg: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
      --text-primary: #ffffff;
      --text-secondary: #cccccc;
      --text-muted: #888888;
      --accent-green: #00ff88;
      --accent-blue: #00aaff;
      --accent-red: #ff4444;
      --accent-yellow: #ffaa00;
      --border-color: rgba(255, 255, 255, 0.1);
      --shadow-dark: 0 8px 32px rgba(0, 0, 0, 0.6);
      --shadow-glow: 0 0 20px rgba(0, 255, 136, 0.3);
      --blur-bg: rgba(0, 0, 0, 0.8);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, sans-serif;
      background: var(--bg-primary); color: var(--text-primary);
      line-height: 1.6; overflow-x: hidden;
    }
    body::before {
      content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background:
        radial-gradient(circle at 20% 20%, rgba(0, 255, 136, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(0, 170, 255, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 40% 60%, rgba(255, 68, 68, 0.03) 0%, transparent 50%);
      z-index: -1; animation: backgroundPulse 10s ease-in-out infinite alternate;
    }
    @keyframes backgroundPulse { 0% { opacity: 0.3; } 100% { opacity: 0.7; } }

    header {
      position: sticky; top: 0; z-index: 1000; background: var(--blur-bg);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color); padding: 1.5rem 2rem; text-align: center;
    }
    header h1 {
      font-size: 2.5rem; font-weight: 700;
      background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-blue) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; text-shadow: 0 0 30px rgba(0, 255, 136, 0.5); letter-spacing: -0.02em;
    }

    .container {
      max-width: 1400px; margin: 0 auto; padding: 3rem 2rem;
      display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;
    }
    .card {
      background: var(--card-bg); border-radius: 24px; border: 1px solid var(--border-color);
      box-shadow: var(--shadow-dark); padding: 2rem; position: relative; overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px); animation: slideInUp 0.6s ease-out forwards;
    }
    .card:nth-child(2) { animation-delay: 0.2s; }
    .card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
      background: linear-gradient(90deg, var(--accent-green), var(--accent-blue), var(--accent-green));
      background-size: 200% 100%; animation: shimmer 3s ease-in-out infinite;
    }
    @keyframes shimmer { 0%, 100% { background-position: -200% 0; } 50% { background-position: 200% 0; } }
    .card:hover {
      transform: translateY(-8px); box-shadow: var(--shadow-dark), var(--shadow-glow);
      border-color: var(--accent-green);
    }
    .card h3 {
      font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem;
      color: var(--text-primary); display: flex; align-items: center; gap: 0.75rem;
    }
    .card h3::before {
      content: ''; width: 8px; height: 8px; background: var(--accent-green);
      border-radius: 50%; box-shadow: 0 0 10px var(--accent-green);
      animation: pulse 2s ease-in-out infinite;
    }
    @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.2); } }
    .controls { display: flex; flex-direction: column; gap: 1.25rem; }
    button, .btn-primary, .abaBtn, .btn-secao {
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border: 1px solid var(--border-color); border-radius: 16px; color: var(--text-primary);
      cursor: pointer; font-size: 0.9rem; font-weight: 600; padding: 1rem 1.5rem;
      position: relative; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden;
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      text-transform: uppercase; letter-spacing: 0.5px;
    }
    button::before, .btn-primary::before, .abaBtn::before, .btn-secao::before {
      content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s ease;
    }
    button:hover::before, .btn-primary:hover::before, .abaBtn:hover::before, .btn-secao:hover::before { left: 100%; }
    button:hover, .btn-primary:hover, .abaBtn:hover, .btn-secao:hover {
      transform: translateY(-2px); border-color: var(--accent-green);
      box-shadow: 0 8px 25px rgba(0, 255, 136, 0.2);
    }
    button:active, .btn-primary:active, .abaBtn:active, .btn-secao:active { transform: translateY(0); }
    .btn-primary {
      background: linear-gradient(135deg, var(--accent-green) 0%, #00cc70 100%);
      border-color: var(--accent-green); box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
    }
    .btn-primary:hover { box-shadow: 0 8px 30px rgba(0, 255, 136, 0.5); transform: translateY(-3px); }
    .abaBtn { flex: 1; margin: 0; background: transparent; border-color: var(--border-color); }
    .abaBtn.ativo, .btn-secao.ativo {
      background: linear-gradient(135deg, var(--accent-green) 0%, #00cc70 100%);
      box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
      border-color: var(--accent-green); color: #0a0a0a;
    }
    input[type="range"] {
      width: 100%; height: 8px; border-radius: 4px;
      background: linear-gradient(90deg, #333 0%, var(--accent-green) 100%);
      outline: none; -webkit-appearance: none; margin: 1rem 0;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
      border-radius: 50%; background: var(--accent-green); cursor: pointer;
      border: 2px solid #fff; box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
    }
    input[type="range"]::-moz-range-thumb {
      width: 20px; height: 20px; border-radius: 50%; background: var(--accent-green);
      cursor: pointer; border: 2px solid #fff; box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
    }
    #tempoLabel { text-align: center; font-size: 1.1rem; font-weight: 600; color: var(--accent-green); margin-top: 0.5rem; }
    .dados-grid { display: grid; gap: 1rem; }
    .dado-item {
      background: rgba(255, 255, 255, 0.05); border-radius: 12px;
      padding: 1.25rem; border: 1px solid var(--border-color); transition: all 0.3s ease;
    }
    .dado-item:hover { background: rgba(255, 255, 255, 0.08); border-color: var(--accent-green); }
    .dado-item strong { color: var(--text-secondary); font-size: 0.9rem; display: block; margin-bottom: 0.5rem; }
    .dado-item span { color: var(--text-primary); font-size: 1.2rem; font-weight: 600; }
    .destaque-verde { color: var(--accent-green) !important; animation: highlight 2s ease-in-out; }
    @keyframes highlight { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; transform: scale(1.05); } }

    #relatorioContainer {
      grid-column: span 2; background: var(--card-bg); border-radius: 24px;
      border: 1px solid var(--border-color); box-shadow: var(--shadow-dark);
      padding: 2rem; display: none; opacity: 0; transform: translateY(30px);
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    #relatorioContainer.mostrar { display: block; opacity: 1; transform: translateY(0); }
    .abaBtns-container { display: flex; gap: 1rem; margin-bottom: 2rem; background: rgba(0, 0, 0, 0.3); border-radius: 16px; padding: 0.5rem; }
    .relatorioItem {
      background: linear-gradient(135deg, #1a1a1a 0%, #252525 100%);
      border: 1px solid var(--border-color); border-radius: 16px;
      margin-bottom: 1.5rem; padding: 1.5rem; position: relative;
      animation: slideInUp 0.6s ease-out; transition: all 0.3s ease;
    }
    .relatorioItem:hover { border-color: var(--accent-green); transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4); }
    .botaoExcluir {
      position: absolute; top: 1rem; right: 1rem; background: rgba(255, 68, 68, 0.2);
      border: 1px solid var(--accent-red); border-radius: 8px; color: var(--accent-red);
      font-size: 1.2rem; width: 32px; height: 32px; padding: 0;
      display: flex; align-items: center; justify-content: center; cursor: pointer;
    }
    .botaoExcluir:hover { background: var(--accent-red); color: white; }

    #sobreDashboard {
      display: none; grid-column: span 2; background: var(--bg-primary);
      border-radius: 24px; padding: 0; min-height: 400px;
      opacity: 0; transform: translateY(30px);
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden;
      position: relative;
      z-index: 10;
    }
    #sobreDashboard.mostrar { display: block; opacity: 1; transform: translateY(0); }

    .secao-cinematica {
      display: flex; align-items: center; min-height: 50vh;
      position: relative; padding: 4rem 3rem;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      margin-bottom: 2rem; border-radius: 24px; overflow: hidden;
      transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }
    .secao-cinematica:last-child { margin-bottom: 0; }
    .secao-cinematica.invertida { flex-direction: row-reverse; background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%); }
    #secao-requisitos .secao-cinematica { opacity: 0; transform: translateY(50px); }
    #secao-requisitos .secao-cinematica.is-visible { opacity: 1; transform: translateY(0px); }
    .secao-cinematica.is-pinned { }

    .conteudo-texto { flex: 1; padding: 2rem; z-index: 2; opacity: 1; }
    .conteudo-texto h2 {
      font-size: 3rem; font-weight: 700; margin-bottom: 2rem;
      background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-blue) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; line-height: 1.2; text-shadow: 0 4px 8px rgba(0,0,0,0.5);
      opacity: 1; filter: blur(0px);
    }
     .conteudo-texto h3 {
      font-size: 1.8rem; font-weight: 600; margin-bottom: 1.5rem;
      color: var(--accent-green); opacity: 1; filter: blur(0px);
      transition: filter 0.4s ease-out, opacity 0.4s ease-out;
    }
    .conteudo-texto p, .conteudo-texto pre {
      font-size: 1.2rem; line-height: 1.8; color: var(--text-secondary);
      margin-bottom: 1.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      opacity: 0; filter: blur(6px); transform: translateY(20px);
      transition: opacity 0.5s ease-out, filter 0.5s ease-out, transform 0.5s ease-out;
    }
     #secao-prototipo .conteudo-texto p:first-of-type,
     #secao-versaoFinal .conteudo-texto p:first-of-type { transform: translateY(0px); }
     #secao-requisitos .secao-cinematica:not(.static-text) .conteudo-texto pre { transform: translateY(0px); }
     .conteudo-texto pre {
        background-color: rgba(0,0,0,0.3); border: 1px solid var(--border-color);
        border-radius: 8px; padding: 1em; overflow-x: auto;
        font-family: 'Courier New', monospace; font-size: 0.85em;
        line-height: 1.6; color: #d0d0d0;
     }
    #secao-requisitos .secao-cinematica.static-text .conteudo-texto h3,
    #secao-requisitos .secao-cinematica.static-text .conteudo-texto pre {
        opacity: 1; filter: blur(0px); transform: translateY(0px);
    }
    .conteudo-midia {
      flex: 1; display: flex; align-items: center; justify-content: center;
      gap: 2rem; position: relative; height: 600px; z-index: 1;
    }
    .frame-scroll-container {
      position: relative; max-width: 500px; width: 100%; border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.7); border: 2px solid var(--border-color);
      overflow: hidden; background: #000; display: flex;
      align-items: center; justify-content: center; aspect-ratio: 16/9;
    }
    .frame-scroll-container.fixed-image-container {
        aspect-ratio: unset; height: auto; max-height: 500px;
        background: transparent; border: none; box-shadow: none;
    }
    .frame-scroll { width: 100%; height: 100%; object-fit: cover; display: block; transition: opacity 0.1s ease; }
    .frame-scroll.fixed-image {
        object-fit: contain; max-height: 100%; max-width: 100%;
        width: auto; height: auto; border-radius: 10px;
    }
    .slider-vertical-container { width: 40px; height: 400px; display: flex; align-items: center; justify-content: center; }
    .frame-slider-vertical {
      -webkit-appearance: none; appearance: none; width: 350px; height: 6px;
      background: #333; outline: none; border-radius: 3px; transform: rotate(-90deg);
      cursor: pointer; margin: 0; transition: background 0.2s ease;
    }
    .frame-slider-vertical:hover { background: #444; }
    .frame-slider-vertical::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none; width: 24px; height: 24px;
      border-radius: 50%; background: var(--accent-green); cursor: pointer;
      border: 3px solid #fff; box-shadow: 0 0 15px rgba(0, 255, 136, 0.7);
      transition: transform 0.2s ease;
    }
    .frame-slider-vertical::-webkit-slider-thumb:hover { transform: scale(1.1); }
    .frame-slider-vertical::-moz-range-thumb {
      width: 24px; height: 24px; border-radius: 50%; background: var(--accent-green);
      cursor: pointer; border: 3px solid #fff; box-shadow: 0 0 15px rgba(0, 255, 136, 0.7);
      transition: transform 0.2s ease;
    }
    .frame-slider-vertical::-moz-range-thumb:hover { transform: scale(1.1); }
    .frame-slider-vertical::-moz-range-track { background: transparent; border: none; }
    .secao-cinematica::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.4) 100%); z-index: 1;
    }

    .navegacao-secoes {
      display: flex; justify-content: center; gap: 1rem; padding: 1rem 2rem;
      background: var(--blur-bg); backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px); border-radius: 20px;
      margin-bottom: 2rem; position: sticky; top: 20px;
      z-index: 999; border: 1px solid var(--border-color);
    }
    .progress-indicator { position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: rgba(255,255,255,0.1); z-index: 1001; }
    .progress-bar { height: 100%; background: linear-gradient(90deg, var(--accent-green), var(--accent-blue)); width: 0%; transition: width 0.1s ease; box-shadow: 0 0 10px rgba(0, 255, 136, 0.5); }
    .secao-conteudo { display: none; animation: fadeInUp 0.8s ease-out; padding-top: 80px; }
    #secao-requisitos .requisitos-title-container { padding-top: 0; margin-bottom: 1rem; position: relative; z-index: 1; }
    .secao-conteudo.ativa { display: block; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }

    #animacaoRacao {
      position: fixed; top: 120px; right: 2rem; width: 220px; z-index: 9999;
      opacity: 0; pointer-events: none; transition: opacity 0.6s ease, transform 0.6s ease;
      border-radius: 20px; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.6);
      border: 2px solid var(--accent-green); transform: translateX(100px);
      background: var(--bg-secondary); padding: 1rem;
    }
    #animacaoRacao.mostrar { opacity: 1; transform: translateX(0); }
    .animacao-wrapper { display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .loading-text { color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.75rem; text-align: center; }
    .frame-counter {
      position: fixed; bottom: 20px; right: 20px; background: var(--blur-bg);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--border-color); color: var(--accent-green);
      padding: 12px 16px; border-radius: 12px; font-family: 'Courier New', monospace;
      font-size: 0.9rem; z-index: 1000; display: none;
    }

    #secao-final {
      position: relative; width: 100%; height: 400vh;
      margin-top: 5rem; z-index: 5;
    }
    #frame-final-sticky-container {
      position: sticky; top: 0; width: 100%;
      height: 100vh; overflow: hidden;
    }
    #frame-final {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 0.1s ease;
    }
    #final-texto-overlay {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: #000000; display: flex; flex-direction: column;
      align-items: center; justify-content: center; text-align: center;
      z-index: 10000;
      opacity: 0;
      pointer-events: none;
      font-family: 'Segoe UI Black', 'Arial Black', sans-serif;
      text-transform: uppercase;
    }
    #final-texto-overlay h2 {
      font-size: 3.5rem; color: #fff; margin-bottom: 1rem;
      text-shadow: 0 0 5px #fff, 0 0 15px var(--accent-blue), 0 0 25px var(--accent-blue);
      letter-spacing: 0.1em;
    }
    #final-texto-overlay p {
      font-size: 1.5rem; color: var(--text-secondary); margin-bottom: 2rem;
      font-weight: normal; text-transform: none; text-shadow: none;
    }
    .github-link {
      display: inline-flex; align-items: center; gap: 1rem;
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border: 1px solid var(--border-color); border-radius: 16px;
      color: var(--text-primary); text-decoration: none;
      font-size: 1.2rem; font-weight: 600; padding: 1rem 2rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    }
    .github-link .fa-github {
        font-size: 24px;
        vertical-align: middle;
    }
    .github-link:hover {
      transform: translateY(-3px); border-color: var(--accent-green);
      box-shadow: 0 8px 30px rgba(0, 255, 136, 0.3); color: var(--accent-green);
    }

    @media (max-width: 992px) {
        .secao-cinematica { flex-direction: column !important; text-align: center; padding: 2rem 1.5rem; }
        .conteudo-midia { flex-direction: column; height: auto; gap: 1.5rem; }
        .slider-vertical-container { width: 100%; height: 60px; }
        .frame-slider-vertical { transform: rotate(0deg); width: 80%; height: 8px; }
        .frame-scroll-container.fixed-image-container { max-height: 300px; }
    }
    @media (max-width: 768px) {
      .container { grid-template-columns: 1fr; padding: 2rem 1rem; gap: 1.5rem; }
      header h1 { font-size: 2rem; }
      .conteudo-texto h2, .conteudo-texto h3 { font-size: 2rem; }
      .navegacao-secoes { flex-direction: column; gap: 0.5rem; top: 60px;}
      .secao-conteudo { padding-top: 60px; }
      #secao-requisitos .requisitos-title-container h1 { font-size: 2.5rem;}
      #secao-requisitos .requisitos-title-container h2 { font-size: 1.2rem;}
      #animacaoRacao { width: 180px; right: 1rem; padding: 0.5rem; }
      .loading-text { font-size: 0.8rem; margin-top: 0.5rem;}
      #final-texto-overlay h2 { font-size: 2.5rem; }
      #final-texto-overlay p { font-size: 1.2rem; }
      .github-link { font-size: 1rem; padding: 0.8rem 1.5rem; }
    }
    @keyframes slideInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>
  <div class="progress-indicator"> <div class="progress-bar" id="progressBar"></div> </div>
  <div class="frame-counter" id="frameCounter"> Frame: 1 / Total: 37 </div>
  <header> <h1>PetFeeder Dashboard</h1> </header>

  <div class="container">
     <div class="card">
      <h3>Controle Remoto</h3>
      <div class="controls">
        <button id="btnAbrirPorta" class="btn-primary">Abrir PetFeeder</button>
        <label for="tempoRange">Tempo de Abertura (ms)</label>
        <input type="range" id="tempoRange" min="1000" max="10000" step="1000" value="5000">
        <div id="tempoLabel">5000 ms</div>
        <button id="btnDefinirTempo">Definir Tempo</button>
        <div style="display: flex; gap: 1rem;">
          <button id="btnVerRelatorio" class="abaBtn">Ver Relatório</button>
          <button id="btnSobreDashboard" class="abaBtn">Sobre o Dashboard</button>
        </div>
      </div>
    </div>
    <div class="card">
      <h3>Últimos Dados</h3>
      <div class="dados-grid">
        <div class="dado-item"> <strong>Distância</strong> <span id="distancia">--</span> cm </div>
        <div class="dado-item"> <strong>Potenciômetro</strong> <span id="pot">--</span> </div>
        <div class="dado-item"> <strong>Tempo Abertura</strong> <span id="tempo">--</span> ms </div>
        <div class="dado-item"> <strong>Modo</strong> <span id="modo" class="">--</span> </div>
        <div class="dado-item"> <strong>Evento</strong> <span id="evento" class="">Aguardando...</span> </div>
      </div>
    </div>

    <div id="relatorioContainer">
      <h3>Relatórios Gerados</h3>
      <div class="abaBtns-container">
        <button id="btnAbaFirebase" class="abaBtn ativo" data-aba="firebase">Firebase</button>
        <button id="btnAbaBotao" class="abaBtn" data-aba="botao">Botão</button>
        <button id="btnAbaSensor" class="abaBtn" data-aba="sensor">Sensor</button>
      </div>
      <div id="firebase" class="abaRelatorio" style="display: block;"></div>
      <div id="botao" class="abaRelatorio" style="display: none;"></div>
      <div id="sensor" class="abaRelatorio" style="display: none;"></div>
    </div>

    <div id="sobreDashboard" class="">
      <div class="navegacao-secoes">
         <button id="btnSecaoPrototipo" class="btn-secao ativo" data-secao="prototipo">Protótipo</button>
         <button id="btnSecaoVersaoFinal" class="btn-secao" data-secao="versaoFinal">Versão Final</button>
         <button id="btnSecaoRequisitos" class="btn-secao" data-secao="requisitos">Requisitos</button>
      </div>

       <div id="secao-prototipo" class="secao-conteudo ativa">
         <div class="secao-cinematica" data-id="prototipo" data-frames="37" data-base-url="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/frame%20">
          <div class="conteudo-texto">
            <h2>Protótipo</h2>
            <p>O foco do projeto foi cumprir os requisitos da disciplina de Sistemas Embarcados. Começamos com um sensor PIR, mas trocamos por um ultrassônico mais preciso.</p>
            <p>O potenciômetro controla a quantidade de ração, e um LED indica a abertura do alimentador. Enfrentamos problemas com fios defeituosos e um curto inicial, o que reforçou a importância da organização.</p>
            <p>Finalizamos com a integração do Firebase para controle remoto e registro dos dados.</p>
          </div>
          <div class="conteudo-midia">
            <div class="frame-scroll-container"> <img id="frame-prototipo" class="frame-scroll" src="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/frame%20(1).gif" alt="Protótipo PetFeeder"> </div>
            <div class="slider-vertical-container"> <input type="range" class="frame-slider-vertical" id="slider-prototipo" min="1" max="37" value="1"> </div>
          </div>
        </div>
      </div>

      <div id="secao-versaoFinal" class="secao-conteudo">
         <div class="secao-cinematica invertida" data-id="versaoFinal" data-frames="38" data-base-url="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/frame_final%20">
          <div class="conteudo-texto">
            <h2>Versão Final</h2>
            <p>O visual final do nosso projeto ficou bem próximo do que imaginávamos, com um toque artesanal. Inicialmente, a ideia era utilizar impressão 3D, mas o tempo era nosso maior inimigo.</p>
            <p>Optamos, então, por usar papelão — que cumpriu a função da mesma forma. A estrutura é composta por uma caixa com uma rampa e um portão que abre e fecha (controlado por um motor servo), além de um sensor na parte frontal para detectar a presença do animal.</p>
            <p>Na versão final, decidimos deixar visíveis apenas o potenciômetro e o sensor ultrassônico.</p>
          </div>
          <div class="conteudo-midia">
            <div class="frame-scroll-container"> <img id="frame-versaoFinal" class="frame-scroll" src="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/frame_final%20(1).gif" alt="Versão Final PetFeeder"> </div>
            <div class="slider-vertical-container"> <input type="range" class="frame-slider-vertical" id="slider-versaoFinal" min="1" max="38" value="1"> </div>
          </div>
        </div>
      </div>

      <div id="secao-requisitos" class="secao-conteudo">
        <div class="requisitos-title-container" style="text-align: center; padding-bottom:1rem; border-bottom: 1px solid var(--border-color); margin-bottom: 2rem;">
            <h1 style="font-size: 3rem; margin-bottom: 0.5rem; background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-blue) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 0 30px rgba(0, 255, 136, 0.5);">REQUISITOS</h1>
            <h2 style="font-size: 1.5rem; color: var(--text-secondary); font-weight: 500;">Sistemas Embarcados 2025.1</h2>
        </div>
        <div class="secao-cinematica" data-frames="135" data-base-url="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/led%20" data-requirement-id="led">
            <div class="conteudo-texto">
                <h3>Uso da LED (com PWM)</h3>
                <pre><code>int brilhoInicial = 255;
unsigned long tempoInicioAcionamento = 0;

void acionarServoNaoBloqueante(int tempoEmMs) {
  servo1.write(90);
  analogWrite(LED_PIN, brilhoInicial);
  tempoInicioAcionamento = millis();
  tempoAcionamento = tempoInicioAcionamento + tempoEmMs;
  servoAtivo = true;
}

void atualizarServo() {
  if (servoAtivo) {
    unsigned long agora = millis();

    if (agora >= tempoAcionamento) {
      servo1.write(0);
      analogWrite(LED_PIN, 0);
      servoAtivo = false;
    } else {
      int tempoTotal = tempoAcionamento - tempoInicioAcionamento;
      int tempoDecorrido = agora - tempoInicioAcionamento;
      int brilhoAtual = map(tempoDecorrido, 0, tempoTotal, brilhoInicial, 0);
      brilhoAtual = constrain(brilhoAtual, 0, 255);
      analogWrite(LED_PIN, brilhoAtual);
    }
  }
}</code></pre>
            </div>
            <div class="conteudo-midia">
                <div class="frame-scroll-container"> <img id="frame-req-led" class="frame-scroll" src="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/led%20(1).gif" alt="Requisito LED"> </div>
                <div class="slider-vertical-container"> <input type="range" class="frame-slider-vertical" id="slider-req-led" min="1" max="135" value="1"> </div>
            </div>
        </div>
        <div class="secao-cinematica invertida" data-frames="75" data-base-url="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/botao%20" data-requirement-id="botao">
            <div class="conteudo-texto">
                <h3>Uso do botão físico</h3>
                <pre><code>#define BOTAO_PIN 33
bool estadoAnteriorBotao = HIGH;

void loop() {
  // ...
  bool estadoBotao = digitalRead(BOTAO_PIN);
  bool cliqueDetectado = (estadoAnteriorBotao == HIGH &amp;&amp; estadoBotao == LOW);
  estadoAnteriorBotao = estadoBotao;

  if (cliqueDetectado) {
    acionarServoNaoBloqueante(tempoEmMs);
    enviarDadosParaFirebase(distancia, potValue, tempoEmMs, origemPrioritaria, "Abertura manual via botão");
  }
  // ...
}</code></pre>
            </div>
            <div class="conteudo-midia">
                <div class="frame-scroll-container"> <img id="frame-req-botao" class="frame-scroll" src="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/botao%20(1).gif" alt="Requisito Botão"> </div>
                <div class="slider-vertical-container"> <input type="range" class="frame-slider-vertical" id="slider-req-botao" min="1" max="75" value="1"> </div>
            </div>
        </div>
        <div class="secao-cinematica" data-frames="66" data-base-url="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/motor%20" data-requirement-id="motor">
            <div class="conteudo-texto">
                <h3>Uso do servo motor</h3>
                <pre><code>#include &lt;ESP32Servo.h&gt;
#define SERVO_PIN 27

Servo servo1;

void setup() {
  // ...
  servo1.attach(SERVO_PIN);
}

void acionarServoNaoBloqueante(int tempoEmMs) {
  servo1.write(90);
  // ...
}</code></pre>
            </div>
            <div class="conteudo-midia">
                <div class="frame-scroll-container"> <img id="frame-req-motor" class="frame-scroll" src="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/motor%20(1).gif" alt="Requisito Servo Motor"> </div>
                <div class="slider-vertical-container"> <input type="range" class="frame-slider-vertical" id="slider-req-motor" min="1" max="66" value="1"> </div>
            </div>
        </div>
        <div class="secao-cinematica invertida" data-frames="77" data-base-url="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/sensor%20" data-requirement-id="sensor">
            <div class="conteudo-texto">
                <h3>Uso do sensor ultrassônico</h3>
                <pre><code>#define TRIG_PIN 23
#define ECHO_PIN 22

float medirDistanciaCM() {
  digitalWrite(TRIG_PIN, LOW);
  delayMicroseconds(2);
  digitalWrite(TRIG_PIN, HIGH);
  delayMicroseconds(10);
  digitalWrite(TRIG_PIN, LOW);

  long duracao = pulseIn(ECHO_PIN, HIGH, 30000);
  float distancia = duracao * 0.034 / 2;
  return distancia;
}

void loop() {
  float distancia = medirDistanciaCM();

  if (distancia > 0 &amp;&amp; distancia &lt; 20) {
    acionarServoNaoBloqueante(tempoEmMs);
    enviarDadosParaFirebase(distancia, potValue, tempoEmMs, origemPrioritaria, "Abertura automática por sensor");
  }
}</code></pre>
            </div>
            <div class="conteudo-midia">
                <div class="frame-scroll-container"> <img id="frame-req-sensor" class="frame-scroll" src="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/sensor%20(1).gif" alt="Requisito Sensor Ultrassônico"> </div>
                <div class="slider-vertical-container"> <input type="range" class="frame-slider-vertical" id="slider-req-sensor" min="1" max="77" value="1"> </div>
            </div>
        </div>
        <div class="secao-cinematica" data-frames="93" data-base-url="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/pot%20" data-requirement-id="pot">
            <div class="conteudo-texto">
                <h3>Uso do potenciômetro</h3>
                <pre><code>#define POTENTIOMETER_PIN 32

int ultimoPotIndice = -1;
String origemPrioritaria = "potenciometro";
int tempoEmMs = 1000;

void loop() {
  int potValue = analogRead(POTENTIOMETER_PIN);
  int indicePot = map(potValue, 0, 4095, 0, 18);
  int tempoPotenciometro = 1000 + (indicePot * 500);

  if (indicePot == 0) {
    if (origemPrioritaria != "firebase") {
      origemPrioritaria = "firebase";
      if (!modoAP) {
        Firebase.setString(fbdo, "/comando/origem", "firebase");
      }
    }
  } else {
    if (indicePot != ultimoPotIndice) {
      if (origemPrioritaria != "potenciometro") {
        origemPrioritaria = "potenciometro";
        if (!modoAP) {
          Firebase.setString(fbdo, "/comando/origem", "potenciometro");
        }
      }
      ultimoPotIndice = indicePot;
      tempoEmMs = tempoPotenciometro;
      if (!modoAP) {
        Firebase.setInt(fbdo, "/comando/tempo_remoto_ms", tempoEmMs);
      }
    }
  }
}</code></pre>
            </div>
            <div class="conteudo-midia">
                <div class="frame-scroll-container"> <img id="frame-req-pot" class="frame-scroll" src="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/pot%20(1).gif" alt="Requisito Potenciômetro"> </div>
                <div class="slider-vertical-container"> <input type="range" class="frame-slider-vertical" id="slider-req-pot" min="1" max="93" value="1"> </div>
            </div>
        </div>
        <div class="secao-cinematica invertida static-text" data-requirement-id="firebase">
            <div class="conteudo-texto">
                <h3>Uso do Firebase</h3>
                <pre><code>#include &lt;FirebaseESP32.h&gt;

FirebaseData fbdo;
FirebaseAuth auth;
FirebaseConfig config;

void iniciarFirebase() {
  config.database_url = DATABASE_URL;
  config.signer.tokens.legacy_token = DATABASE_SECRET;
  Firebase.reconnectNetwork(true);
  fbdo.setBSSLBufferSize(4096, 1024);
  Firebase.begin(&amp;config, &amp;auth);
}

void enviarDadosParaFirebase(float distancia, int potValue, int tempo, const String &amp;modo, const String &amp;evento) {
  if (modoAP || !Firebase.ready()) return;

  Firebase.setFloat(fbdo, "/estado/distancia_cm", distancia);
  Firebase.setInt(fbdo, "/estado/potenciometro", potValue);
  Firebase.setInt(fbdo, "/estado/tempo_aberto_ms", tempo);
  Firebase.setString(fbdo, "/estado/modo", modo);
  Firebase.setString(fbdo, "/estado/evento", evento);
}</code></pre>
            </div>
            <div class="conteudo-midia">
                <div class="frame-scroll-container fixed-image-container"> <img id="img-req-firebase" class="frame-scroll fixed-image" src="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/firebase.png" alt="Requisito Firebase"> </div>
            </div>
        </div>
        <div class="secao-cinematica static-text" data-requirement-id="ap">
             <div class="conteudo-texto">
                <h3>Criação do Wi-Fi próprio (Access Point)</h3>
                <pre><code>void configurarWiFiDuplo() {
  WiFi.mode(WIFI_AP_STA);
  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
  Serial.print("Conectando à rede Wi-Fi local...");
  unsigned long tempoInicial = millis();
  while (WiFi.status() != WL_CONNECTED &amp;&amp; millis() - tempoInicial &lt; 10000) {
    Serial.print(".");
    delay(500);
  }
  if (WiFi.status() == WL_CONNECTED) {
    Serial.print("\nConectado! IP local: http://");
    Serial.print(WiFi.localIP());
    Serial.println("/index.html");
    modoAP = false;
  } else {
    Serial.println("\nFalha ao conectar. Iniciando AP...");
    const char* ssidAP = "PetFeeder";
    const char* senhaAP = "senha1234";
    WiFi.softAP(ssidAP, senhaAP);
    Serial.print("Access Point iniciado! IP: ");
    Serial.println(WiFi.softAPIP());
    modoAP = true;
  }
}</code></pre>
            </div>
            <div class="conteudo-midia">
                <div class="frame-scroll-container fixed-image-container"> <img id="img-req-ap" class="frame-scroll fixed-image" src="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/AP.jpeg" alt="Requisito Access Point"> </div>
            </div>
        </div>
        <div class="secao-cinematica invertida static-text" data-requirement-id="interfacehtml">
            <div class="conteudo-texto">
                <h3>Interface HTML embutida no ESP32</h3>
                <pre><code>const char SIMPLE_HTML_PAGE[] PROGMEM = R"rawliteral(
&lt;!DOCTYPE html&gt;
&lt;html lang="pt-BR"&gt;
&lt;head&gt;&lt;meta charset="UTF-8" /&gt;&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"/&gt;
&lt;title&gt;PetFeeder Local&lt;/title&gt;
&lt;style&gt;body { font-family: Arial; background: #f0f0f0; padding: 20px; text-align: center; } button, input { padding: 10px 20px; margin: 10px; font-size: 16px; } #status { margin-top: 20px; }&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Controle PetFeeder&lt;/h1&gt;
&lt;input type="number" id="tempo" placeholder="Tempo em ms" min="1000" max="10000"&gt;&lt;br&gt;
&lt;button onclick="abrir()"&gt;🔓 Abrir Porta&lt;/button&gt;
&lt;div id="status"&gt;Status: aguardando ação...&lt;/div&gt;
&lt;script&gt;
async function abrir() {
  const tempo = document.getElementById('tempo').value || 3000;
  const res = await fetch("/abrir?tempo=" + tempo);
  const txt = await res.text();
  document.getElementById("status").innerText = "Status: " + txt;
}
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
)rawliteral";</code></pre>
            </div>
            <div class="conteudo-midia">
                 <div class="frame-scroll-container fixed-image-container"> <img id="img-req-interface" class="frame-scroll fixed-image" src="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/interfaceAP.jpeg" alt="Requisito Interface HTML"> </div>
            </div>
        </div>
      </div>
    </div>
  </div>

  <div id="secao-final">
      <div id="frame-final-sticky-container">
          <img id="frame-final" class="frame-scroll-final" src="https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/caixa%20(1).gif" alt="Animação Final">
          <div id="final-texto-overlay">
              <h2>Espero que tenha gostado</h2>
              <p>Para saber mais:</p>
              <a href="https://github.com/JoaoPNobrega/PetFeeder-Front" target="_blank" class="github-link">
                  <i class="fa-brands fa-github"></i>
                  <span>JoaoPNobrega/PetFeeder-Front</span>
              </a>
          </div>
      </div>
  </div>

  <div id="animacaoRacao" style="display:none;">
    <div class="animacao-wrapper">
        <div class="tenor-gif-embed" data-postid="1745012748969606150" data-share-method="host" data-aspect-ratio="1.36364" data-width="100%">
        <a href="https://tenor.com/view/kitty-hello-street-cat-mr-fear-tgb-the-gluttonous-beast-gif-1745012748969606150"> Kitty Hello Street Cat GIF </a> from <a href="https://tenor.com/search/kitty-gifs">Kitty GIFs</a>
        </div>
        <p class="loading-text">Ração caindo...</p>
    </div>
  </div>
  <script type="text/javascript" async src="https://tenor.com/embed.js"></script>

  <script type="module">
     // Importa as funções necessárias do Firebase SDK (v9+)
     import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
     // Importa o Realtime Database e suas funções
     import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";
     // Opcional: Analytics (se quiser usar)
     // import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js";

     // Sua configuração do Firebase (COLE A SUA AQUI - CUIDADO COM A CHAVE EM REPOSITÓRIOS PÚBLICOS)
     const firebaseConfig = {
       apiKey: "AIzaSyClMqeoGTnDv71Qnp-kPs9Yxifqc5_R7og", // Use sua chave real
       authDomain: "petfeed-se.firebaseapp.com",
       databaseURL: "https://petfeed-se-default-rtdb.firebaseio.com",
       projectId: "petfeed-se",
       storageBucket: "petfeed-se.appspot.com",
       messagingSenderId: "651255070724",
       appId: "1:651255070724:web:248b534e42c5887b2b3551",
       measurementId: "G-DVH6XGRDBX"
     };

     // Inicializa o Firebase
     const app = initializeApp(firebaseConfig);
     // Obtém a referência do Realtime Database
     const database = getDatabase(app);
     // const analytics = getAnalytics(app); // Descomente se usar Analytics

     // --- VARIÁVEIS GLOBAIS ---
     let ultimoEvento = null;
     let frameScrollSystems = [];
     let requisitosObservers = [];
     let pinnableObserver = null;
     let activePinnableSection = null;
     let requisitosScrollListenerActive = false;
     let activeRequisitosScrollSystem = null;
     let finalSectionActive = false;

     const finalSectionElement = document.getElementById('secao-final');
     const finalImageElement = document.getElementById('frame-final');
     const finalTextOverlay = document.getElementById('final-texto-overlay');
     const finalFramesCount = 43;
     const baseUrlCaixa = "https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/caixa%20";

     // --- SEU CÓDIGO DE ANIMAÇÃO E SCROLL ---
    class FrameScrollSystem {
      constructor(element, totalFrames, baseUrl, sliderElement, isStaticTextRequirement = false, isMainSection = true, sectionElement) {
        this.element = element;
        this.totalFrames = totalFrames;
        this.baseUrl = baseUrl;
        this.sliderElement = sliderElement;
        this.isStaticTextRequirement = isStaticTextRequirement;
        this.isMainSection = isMainSection;
        this.currentFrame = 1;
        this.parentCinematicSection = sectionElement;

        this.textContainer = null;
        this.hElement = null;
        this.pElements = [];
        this.preElement = null;

        if (this.parentCinematicSection) {
            this.textContainer = this.parentCinematicSection.querySelector('.conteudo-texto');
            if (this.textContainer) {
                this.hElement = (this.textContainer.querySelector('h2') || this.textContainer.querySelector('h3'));
                if (this.isMainSection) {
                    this.pElements = Array.from(this.textContainer.querySelectorAll('p'));
                } else {
                    this.preElement = this.textContainer.querySelector('pre');
                }
            }
        }

        if (!isStaticTextRequirement && totalFrames > 0 && this.baseUrl && this.element) {
            this.preloadFrames();
        }
        this.setInitialTextState();
      }

      preloadFrames() {
          for (let frameNum = 1; frameNum <= this.totalFrames; frameNum++) {
              const img = new Image();
              img.src = `${this.baseUrl}(${frameNum}).gif`;
          }
      }

      setInitialTextState() {
            if (this.hElement) {
                this.hElement.style.opacity = '1';
                this.hElement.style.filter = 'blur(0px)';
            }

            if (this.isStaticTextRequirement) {
                if (this.preElement) {
                    this.preElement.style.opacity = '1';
                    this.preElement.style.filter = 'blur(0px)';
                    this.preElement.style.transform = 'translateY(0px)';
                }
            } else if (this.isMainSection) {
                if (this.pElements.length > 0) {
                    this.pElements.forEach((p, index) => {
                        p.style.opacity = index === 0 ? '0.3' : '0';
                        p.style.filter = `blur(${index === 0 ? 4 : 6}px)`;
                        p.style.transform = `translateY(${index === 0 ? 0 : 20}px)`;
                    });
                }
            } else {
                if (this.preElement) {
                    this.preElement.style.opacity = '0';
                    this.preElement.style.filter = 'blur(6px)';
                    this.preElement.style.transform = 'translateY(0px)';
                }
            }
      }

      updateFrame(frameNumber, fromPageScroll = false) {
            if (this.isStaticTextRequirement) {
                this.setInitialTextState();
                return;
            }

            frameNumber = Math.max(1, Math.min(this.totalFrames || 1, Math.floor(frameNumber)));

            if (this.element && this.baseUrl && (frameNumber !== this.currentFrame || fromPageScroll) && this.totalFrames > 0 ) {
              this.currentFrame = frameNumber;
              const newSrc = `${this.baseUrl}(${frameNumber}).gif`;
              if (this.element.src !== newSrc) this.element.src = newSrc;
            }

            if (this.sliderElement && parseInt(this.sliderElement.value) !== frameNumber) {
                this.sliderElement.value = frameNumber;
            }

            const counter = document.getElementById('frameCounter');
            if (counter && counter.style.display !== 'none' && this.totalFrames > 0) {
              const activeSectionName = this.parentCinematicSection.dataset.id || this.parentCinematicSection.dataset.requirementId || 'N/A';
              counter.textContent = `Seção: ${activeSectionName} - Frame: ${frameNumber} / ${this.totalFrames}`;
            }

            const progress = (this.totalFrames <= 1) ? 1 : (frameNumber - 1) / (this.totalFrames - 1);

            if (this.hElement) {
                this.hElement.style.opacity = '1'; this.hElement.style.filter = 'blur(0px)';
            }

            if (this.isMainSection && this.pElements.length > 0) {
                this.pElements.forEach((p, index) => {
                    const pStartProgressBase = 0.01, pStaggerFactor = 0.1, pDurationProgress = 0.3;
                    let pStartProgress = (index === 0) ? pStartProgressBase : pStartProgressBase + 0.05 + ((index-1) * pStaggerFactor);
                    let pProgress = Math.min(1, Math.max(0, (progress - pStartProgress) / pDurationProgress));

                    if (index === 0) {
                        p.style.opacity = pProgress < 0.3 ? Math.max(pProgress, 0.3) : pProgress;
                        p.style.filter = `blur(${(1 - pProgress) * 4}px)`;
                        p.style.transform = 'translateY(0px)';
                    } else {
                        p.style.opacity = pProgress;
                        p.style.filter = `blur(${(1 - pProgress) * 6}px)`;
                        p.style.transform = `translateY(${(1 - pProgress) * 20}px)`;
                    }
                });
            } else if (!this.isMainSection && this.preElement) {
                const preStartProgress = 0.01;
                const preDurationProgress = 0.4;
                let currentPreProgress = 0;
                if (progress >= preStartProgress) {
                    currentPreProgress = (progress - preStartProgress) / preDurationProgress;
                }
                currentPreProgress = Math.min(1, Math.max(0, currentPreProgress));

                this.preElement.style.opacity = currentPreProgress;
                this.preElement.style.filter = `blur(${(1 - currentPreProgress) * 6}px)`;
                this.preElement.style.transform = 'translateY(0px)';
            }
       }
    }

    function initFrameScrollSystems() {
        frameScrollSystems = [];
        const sharedBaseUrl = "https://joaopnobrega.github.io/PetFeeder-Front/Embarcados2/data/frames/";
        const sectionsData = [
            { id: 'prototipo', frameImgId: 'frame-prototipo', sliderId: 'slider-prototipo', frames: 37, baseUrlPart: 'frame%20', isMain: true, isStatic: false },
            { id: 'versaoFinal', frameImgId: 'frame-versaoFinal', sliderId: 'slider-versaoFinal', frames: 38, baseUrlPart: 'frame_final%20', isMain: true, isStatic: false },
            { id: 'req-led', requirementIdForQuery: 'led', frameImgId: 'frame-req-led', sliderId: 'slider-req-led', frames: 135, baseUrlPart: 'led%20', isMain: false, isStatic: false },
            { id: 'req-botao', requirementIdForQuery: 'botao', frameImgId: 'frame-req-botao', sliderId: 'slider-req-botao', frames: 75, baseUrlPart: 'botao%20', isMain: false, isStatic: false },
            { id: 'req-motor', requirementIdForQuery: 'motor', frameImgId: 'frame-req-motor', sliderId: 'slider-req-motor', frames: 66, baseUrlPart: 'motor%20', isMain: false, isStatic: false },
            { id: 'req-sensor', requirementIdForQuery: 'sensor', frameImgId: 'frame-req-sensor', sliderId: 'slider-req-sensor', frames: 77, baseUrlPart: 'sensor%20', isMain: false, isStatic: false },
            { id: 'req-pot', requirementIdForQuery: 'pot', frameImgId: 'frame-req-pot', sliderId: 'slider-req-pot', frames: 93, baseUrlPart: 'pot%20', isMain: false, isStatic: false },
            { id: 'req-firebase', requirementIdForQuery: 'firebase', isStatic: true, isMain: false, frameImgId: 'img-req-firebase' },
            { id: 'req-ap', requirementIdForQuery: 'ap', isStatic: true, isMain: false, frameImgId: 'img-req-ap' },
            { id: 'req-interfacehtml', requirementIdForQuery: 'interfacehtml', isStatic: true, isMain: false, frameImgId: 'img-req-interface' }
        ];
        sectionsData.forEach(data => {
            const imgElement = data.frameImgId ? document.getElementById(data.frameImgId) : null;
            const sliderElement = data.sliderId ? document.getElementById(data.sliderId) : null;
            let sectionElement;
            if (data.isMain) sectionElement = document.querySelector(`.secao-cinematica[data-id="${data.id}"]`);
            else sectionElement = document.querySelector(`.secao-cinematica[data-requirement-id="${data.requirementIdForQuery}"]`);
            if (sectionElement) {
                const system = new FrameScrollSystem(imgElement, data.frames || 0, data.baseUrlPart ? `${sharedBaseUrl}${data.baseUrlPart}` : null, sliderElement, data.isStatic, data.isMain, sectionElement);
                frameScrollSystems.push({ id: data.id, system: system, slider: sliderElement, isStatic: data.isStatic, sectionElement: sectionElement });
            }
        });
        frameScrollSystems.forEach(fs => { if (fs.slider) fs.slider.addEventListener('input', () => fs.system.updateFrame(parseInt(fs.slider.value))); fs.system.updateFrame(1); });
    }

    function handlePinnableWheel(event) {
        if (!activePinnableSection) return;
        const fsWrapper = frameScrollSystems.find(f => f.sectionElement === activePinnableSection);
        if (!fsWrapper || !fsWrapper.slider) return;
        const system = fsWrapper.system; const slider = fsWrapper.slider; let currentFrame = parseInt(slider.value);
        const totalFrames = system.totalFrames; const step = event.deltaY > 0 ? 2 : -2; let newFrame = currentFrame + step;
        if (event.deltaY < 0 && currentFrame <= 1) return; if (event.deltaY > 0 && currentFrame >= totalFrames) return;
        event.preventDefault(); newFrame = Math.max(1, Math.min(totalFrames, newFrame)); system.updateFrame(newFrame);
    }

    function createPinnableObserver() {
        const observerOptions = { root: null, rootMargin: '0px', threshold: 0.9 };
        pinnableObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const targetElement = entry.target;
                if (entry.isIntersecting && entry.intersectionRatio >= 0.9) {
                    if (activePinnableSection !== targetElement) {
                        if (activePinnableSection) { activePinnableSection.removeEventListener('wheel', handlePinnableWheel); activePinnableSection.classList.remove('is-pinned'); }
                        activePinnableSection = targetElement; targetElement.addEventListener('wheel', handlePinnableWheel, { passive: false }); targetElement.classList.add('is-pinned');
                    }
                } else {
                    if (targetElement === activePinnableSection) { targetElement.removeEventListener('wheel', handlePinnableWheel); targetElement.classList.remove('is-pinned'); activePinnableSection = null; }
                }
            });
        }, observerOptions);
    }

    function activatePinnableSections() {
        if (!pinnableObserver) createPinnableObserver(); pinnableObserver.disconnect();
        document.querySelectorAll('#secao-prototipo .secao-cinematica, #secao-versaoFinal .secao-cinematica').forEach(el => pinnableObserver.observe(el));
    }

    function deactivatePinnableSections() {
        if (pinnableObserver) pinnableObserver.disconnect();
        if (activePinnableSection) { activePinnableSection.removeEventListener('wheel', handlePinnableWheel); activePinnableSection.classList.remove('is-pinned'); activePinnableSection = null; }
    }

    function handleRequisitosPageScroll() {
        if (!requisitosScrollListenerActive) return; let bestCandidateSystem = null; let highestVisibilityScore = -1;
        const viewportHeight = window.innerHeight; const viewportCenter = viewportHeight / 2;
        document.querySelectorAll('#secao-requisitos .secao-cinematica.is-visible').forEach(section => {
            const reqId = section.dataset.requirementId; const fsWrapper = frameScrollSystems.find(fs => fs.id === `req-${reqId}` && !fs.isStatic && fs.slider);
            if (!fsWrapper) return; const rect = section.getBoundingClientRect(); if (rect.bottom < 0 || rect.top > viewportHeight) return;
            const verticalCenterOfBlock = rect.top + rect.height / 2; const distanceToViewportCenter = Math.abs(viewportCenter - verticalCenterOfBlock);
            const score = 1 - (distanceToViewportCenter / (viewportHeight / 2));
            if (score > highestVisibilityScore) { highestVisibilityScore = score; bestCandidateSystem = fsWrapper; }
        });
        activeRequisitosScrollSystem = bestCandidateSystem;
        if (activeRequisitosScrollSystem) {
            const block = activeRequisitosScrollSystem.sectionElement; const rect = block.getBoundingClientRect();
            let progress = (viewportCenter - rect.top) / rect.height; progress = Math.max(0, Math.min(1, progress));
            const totalFrames = activeRequisitosScrollSystem.system.totalFrames; const frameNumber = Math.round(progress * (totalFrames - 1)) + 1;
            activeRequisitosScrollSystem.system.updateFrame(frameNumber, true);
        }
    }

    // --- FUNÇÃO handleFinalScroll COM FADE-IN AJUSTADO ---
    function handleFinalScroll() {
        const rect = finalSectionElement.getBoundingClientRect();
        const viewportHeight = window.innerHeight;
        if (!finalImageElement || !finalTextOverlay) return;

        if (rect.bottom < 0 || rect.top > viewportHeight) {
            finalSectionActive = false;
            finalImageElement.style.opacity = 0;
            finalTextOverlay.style.opacity = 0;
            finalTextOverlay.style.pointerEvents = 'none';
            if(rect.top > viewportHeight) {
                finalImageElement.src = `${baseUrlCaixa}(1).gif`;
            }
            return;
        }

        finalSectionActive = true;
        let progress = (-rect.top) / (finalSectionElement.offsetHeight - viewportHeight);
        progress = Math.max(0, Math.min(1, progress));

        let frame = Math.round(progress * (finalFramesCount - 1)) + 1;
        frame = Math.max(1, Math.min(finalFramesCount, frame));

        // --- PONTOS DE FADE AJUSTADOS ---
        const imageFadeInStart = 0.10;  // Imagem começa a aparecer em 10%
        const imageFadeInEnd = 0.25;    // Imagem totalmente visível em 25%
        const textFadeInStart = 0.85;   // Texto começa a aparecer em 85%
        const textFadeInEnd = 1.0;      // Texto totalmente visível em 100%
        // --- FIM DOS PONTOS DE FADE ---

        let textOpacity = 0;
        let imageOpacity = 0;

        // Calcula opacidade da Imagem
        if (progress < imageFadeInStart) {
            imageOpacity = 0; // Fica em 0 antes de 10%
        } else if (progress >= imageFadeInStart && progress < imageFadeInEnd) {
            // Fade-in (10% a 25%)
            imageOpacity = (progress - imageFadeInStart) / (imageFadeInEnd - imageFadeInStart);
        } else if (progress >= imageFadeInEnd && progress < textFadeInStart) {
            // Visível (25% a 85%)
            imageOpacity = 1;
        } else if (progress >= textFadeInStart && progress <= textFadeInEnd) {
            // Fade-out (85% a 100%)
            imageOpacity = 1 - ((progress - textFadeInStart) / (textFadeInEnd - textFadeInStart));
        } else {
            imageOpacity = 0; // Fica 0 após 100%
        }

        // Calcula opacidade do Texto (sem mudanças)
        if (progress >= textFadeInStart && progress <= textFadeInEnd) {
            textOpacity = (progress - textFadeInStart) / (textFadeInEnd - textFadeInStart);
        } else if (progress > textFadeInEnd) {
            textOpacity = 1;
        } else {
            textOpacity = 0;
        }

        imageOpacity = Math.max(0, Math.min(1, imageOpacity));
        textOpacity = Math.max(0, Math.min(1, textOpacity));

        // Define o frame
        if (progress < textFadeInStart) {
             // Se a imagem estiver invisível (antes de 10%), usa o frame 1, senão o frame atual
            finalImageElement.src = (progress < imageFadeInStart) ? `${baseUrlCaixa}(1).gif` : `${baseUrlCaixa}(${frame}).gif`;
        } else {
            finalImageElement.src = `${baseUrlCaixa}(${finalFramesCount}).gif`;
        }

        // Aplica as opacidades
        finalImageElement.style.opacity = imageOpacity;
        finalTextOverlay.style.opacity = textOpacity;
        finalTextOverlay.style.pointerEvents = (textOpacity > 0.5) ? 'auto' : 'none';
    }
    // --- FIM DA FUNÇÃO handleFinalScroll ---

    function handleGlobalScroll() {
        handleScroll();
        const finalRect = finalSectionElement.getBoundingClientRect();
        const sobreDashboardRect = document.getElementById('sobreDashboard').getBoundingClientRect();
        if (sobreDashboardRect.bottom < window.innerHeight / 2) {
            if (finalRect.top <= window.innerHeight && finalRect.bottom >= 0) {
                handleFinalScroll();
                if (finalSectionActive) {
                    requisitosScrollListenerActive = false;
                    return;
                }
            } else {
                 if (finalSectionActive) {
                    finalSectionActive = false;
                    finalImageElement.style.opacity = 0;
                    finalTextOverlay.style.opacity = 0;
                    finalTextOverlay.style.pointerEvents = 'none';
                    finalImageElement.src = `${baseUrlCaixa}(1).gif`;
                 }
            }
        }
        if (requisitosScrollListenerActive && !finalSectionActive) {
            handleRequisitosPageScroll();
        }
    }

    function activateRequisitosObserver() {
        requisitosObservers.forEach(obs => obs.disconnect()); requisitosObservers = [];
        const requisitosSections = document.querySelectorAll('#secao-requisitos .secao-cinematica');
        if (requisitosSections.length > 0) {
            const entryObserverOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
            const entryObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('is-visible'); });
            }, entryObserverOptions);
            requisitosSections.forEach(section => entryObserver.observe(section));
            requisitosObservers.push(entryObserver);
        }
    }
    function deactivateRequisitosObservers() { requisitosObservers.forEach(obs => obs.disconnect()); requisitosObservers = []; }

    function mostrarSecao(secaoId) {
        document.querySelectorAll('.secao-conteudo').forEach(div => div.classList.remove('ativa'));
        document.querySelectorAll('.btn-secao').forEach(btn => btn.classList.remove('ativo'));
        const secaoSelecionada = document.getElementById(`secao-${secaoId}`);
        if (secaoSelecionada) secaoSelecionada.classList.add('ativa');
        const botaoSelecionado = document.querySelector(`.btn-secao[data-secao="${secaoId}"]`);
        if (botaoSelecionado) botaoSelecionado.classList.add('ativo');

        deactivatePinnableSections();
        deactivateRequisitosObservers();
        requisitosScrollListenerActive = false;
        finalSectionActive = false;

        if (secaoId === 'prototipo' || secaoId === 'versaoFinal') activatePinnableSections();
        else if (secaoId === 'requisitos') { activateRequisitosObserver(); requisitosScrollListenerActive = true; }

        frameScrollSystems.forEach(fs => {
            const isCurrent = fs.sectionElement.closest('.secao-conteudo.ativa') !== null;
            if (isCurrent) {
                fs.system.setInitialTextState();
                if (fs.system && fs.slider) fs.system.updateFrame(parseInt(fs.slider.value));
            }
        });
        setTimeout(handleScroll, 100);
    }

    function handleScroll() {
      const scrollY = window.scrollY; const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const scrollPercent = docHeight > 0 ? (scrollY / docHeight) * 100 : 0;
      const progressBar = document.getElementById('progressBar'); if (progressBar) progressBar.style.width = `${scrollPercent}%`;
    }

     // --- FUNÇÕES DE DASHBOARD ---
     function destacarElemento(el, duracao = 1000) {
         el.classList.add("destaque-verde");
         setTimeout(() => el.classList.remove("destaque-verde"), duracao);
     }

     document.getElementById("tempoRange").addEventListener("input", function () {
         document.getElementById("tempoLabel").textContent = `${this.value} ms`;
     });

     // --- FUNÇÕES DO FIREBASE (MODIFICADAS/NOVAS) ---

     // Função para ABRIR PORTA (usa SDK)
     async function abrirPorta() {
       const tempo = parseInt(document.getElementById("tempoRange").value);
       try {
         // Envia 'true' para o nó 'comando/abrir'
         await set(ref(database, 'comando/abrir'), true);
         mostrarNotificacaoGIF(tempo);
         if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
         if ('Notification' in window && Notification.permission === 'granted') {
             new Notification('PetFeeder Ativado!', { body: `Alimentador aberto por ${tempo}ms` });
         }
         alert("Comando para abrir PetFeeder enviado!");
       } catch (error) {
         console.error("Erro ao abrir porta via Firebase:", error);
         alert("Falha ao enviar comando.");
       }
     }

     // Função para DEFINIR TEMPO (usa SDK)
     async function definirTempo() {
       const tempo = parseInt(document.getElementById("tempoRange").value);
       try {
         // Envia o valor do tempo para 'comando/tempo_remoto_ms'
         await set(ref(database, 'comando/tempo_remoto_ms'), tempo);
         const tempoLabel = document.getElementById("tempoLabel");
         const originalText = tempoLabel.textContent;
         tempoLabel.textContent = "Definido!";
         tempoLabel.style.color = "var(--accent-green)";
         setTimeout(() => { tempoLabel.textContent = originalText; tempoLabel.style.color = ""; }, 2000);
         alert(`Tempo definido: ${tempo} ms`);
       } catch (error) {
         console.error("Erro ao definir tempo via Firebase:", error);
         alert("Falha ao definir tempo.");
       }
     }

     // Função para ATUALIZAR O DASHBOARD (sem mudanças na lógica, só nos dados)
     function atualizarDashboard(dados) {
         if (!dados) return;
         const els = {
             distancia: document.getElementById('distancia'),
             pot: document.getElementById('pot'),
             tempo: document.getElementById('tempo'),
             modo: document.getElementById('modo'),
             evento: document.getElementById('evento')
         };
         // Use os nomes dos campos como estão no seu Firebase (ex: distancia_cm)
         if (els.distancia && dados.distancia_cm !== undefined && els.distancia.textContent !== dados.distancia_cm.toString()) { els.distancia.textContent = dados.distancia_cm; destacarElemento(els.distancia.parentElement, 2000); }
         if (els.pot && dados.potenciometro !== undefined && els.pot.textContent !== dados.potenciometro.toString()) { els.pot.textContent = dados.potenciometro; destacarElemento(els.pot.parentElement, 2000); }
         if (els.tempo && dados.tempo_aberto_ms !== undefined && els.tempo.textContent !== dados.tempo_aberto_ms.toString()) { els.tempo.textContent = dados.tempo_aberto_ms; destacarElemento(els.tempo.parentElement, 2000); }
         if (els.modo && dados.modo !== undefined && els.modo.textContent !== dados.modo) { els.modo.textContent = dados.modo; destacarElemento(els.modo.parentElement); }
         if (els.evento && dados.evento !== undefined && els.evento.textContent !== dados.evento) { els.evento.textContent = dados.evento; destacarElemento(els.evento.parentElement); }
     }

     // Função para MOSTRAR NOTIFICAÇÃO GIF (sem mudanças)
     function mostrarNotificacaoGIF(duracao = 5000) {
        const animacao = document.getElementById("animacaoRacao");
        animacao.style.display = "block";
        animacao.classList.add('mostrar');
        setTimeout(() => {
            animacao.classList.remove('mostrar');
            setTimeout(() => { animacao.style.display = "none"; }, 600); // Espera a transição terminar
        }, duracao);
     }

     // Função para ADICIONAR UM ITEM DE RELATÓRIO AO HTML (reutilizável)
     function adicionarRelatorioAoHtml(id, dados, aba) {
         const container = document.getElementById(aba);
         if (!container) return;

         // Evita adicionar duplicados se já existir
         if (document.querySelector(`.relatorioItem[data-id="${id}"]`)) return;

         const novoItem = document.createElement("div");
         novoItem.classList.add("relatorioItem");
         novoItem.setAttribute('data-id', id); // Armazena o ID do Firebase
         novoItem.setAttribute('data-aba', aba); // Armazena a aba

         novoItem.innerHTML = `
             <button class="botaoExcluir" data-id="${id}" data-aba="${aba}">&#x2715;</button>
             <ul>
                 <li><strong>Data:</strong> ${new Date(dados.timestamp || Date.now()).toLocaleString('pt-BR')}</li>
                 <li><strong>Distância:</strong> ${dados.distancia_cm || 'N/A'} cm</li>
                 <li><strong>Potenciômetro:</strong> ${dados.potenciometro || 'N/A'}</li>
                 <li><strong>Tempo de Abertura:</strong> ${dados.tempo_aberto_ms || 'N/A'} ms</li>
                 <li><strong>Modo:</strong> ${dados.modo || 'N/A'}</li>
                 <li><strong>Evento:</strong> ${dados.evento || 'N/A'}</li>
             </ul>`;

         container.prepend(novoItem); // Adiciona no início

         // Adiciona o listener para o botão de excluir
         novoItem.querySelector('.botaoExcluir').addEventListener('click', function() {
             excluirRelatorio(this.dataset.id, this.dataset.aba);
         });
     }

     // Função para SALVAR um novo relatório no Firebase
     async function salvarRelatorioFirebase(dados, aba) {
         try {
             const relatoriosRef = ref(database, `relatorios/${aba}`);
             const novoRelatorioRef = push(relatoriosRef); // Gera ID único
             await set(novoRelatorioRef, {
                 ...dados, // Salva todos os dados recebidos
                 timestamp: new Date().toISOString() // Adiciona data/hora
             });
             console.log("Relatório salvo no Firebase:", novoRelatorioRef.key);
         } catch (error) {
             console.error("Erro ao salvar relatório no Firebase:", error);
         }
     }

     // Função para EXCLUIR um relatório (HTML e Firebase)
     async function excluirRelatorio(id, aba) {
         const item = document.querySelector(`.relatorioItem[data-id="${id}"]`);
         if (item) item.remove(); // Remove do HTML

         try {
             // Remove do Firebase
             await remove(ref(database, `relatorios/${aba}/${id}`));
             console.log("Relatório excluído do Firebase:", id);
         } catch (error) {
             console.error("Erro ao excluir relatório do Firebase:", error);
         }
     }

     // Função para CARREGAR TODOS OS RELATÓRIOS do Firebase ao iniciar
     function carregarTodosRelatorios() {
         const relatoriosRef = ref(database, 'relatorios');
         onValue(relatoriosRef, (snapshot) => {
             const todasAbas = snapshot.val();
             // Limpa todas as abas no HTML antes de recarregar
             document.querySelectorAll('.abaRelatorio').forEach(aba => aba.innerHTML = '');

             if (todasAbas) {
                 // Itera sobre cada aba (firebase, botao, sensor)
                 for (const abaNome in todasAbas) {
                     const relatoriosDaAba = todasAbas[abaNome];
                     // Itera sobre cada relatório dentro da aba
                     for (const id in relatoriosDaAba) {
                         adicionarRelatorioAoHtml(id, relatoriosDaAba[id], abaNome);
                     }
                 }
             }
         }, (error) => {
             console.error("Erro ao carregar relatórios:", error);
         });
     }

     // Função para OUVIR DADOS DE ESTADO (usa SDK)
     function ouvirDadosEstado() {
         const estadoRef = ref(database, 'estado');
         onValue(estadoRef, (snapshot) => {
             const dados = snapshot.val();
             if (dados) {
                 atualizarDashboard(dados);
                 const eventoAtual = dados.evento || "";

                 // Verifica se é um evento novo e relevante para salvar
                 if (eventoAtual && eventoAtual !== ultimoEvento) {
                     ultimoEvento = eventoAtual;

                     let abaDestino = "";
                     const eventoLower = eventoAtual.toLowerCase();

                     if (eventoLower.includes("firebase") || eventoLower.includes("remoto")) {
                         abaDestino = "firebase";
                     } else if (eventoLower.includes("botão") || eventoLower.includes("botao")) {
                         abaDestino = "botao";
                     } else if (eventoLower.includes("sensor")) {
                         abaDestino = "sensor";
                     }

                     // Se for um evento que queremos registrar E for uma abertura, salva
                     if (abaDestino && eventoLower.includes("abertura")) {
                          salvarRelatorioFirebase(dados, abaDestino);
                          // Não precisa chamar adicionarRelatorioAoHtml aqui,
                          // pois o listener de carregarTodosRelatorios já fará isso.
                     }

                     // Mostra o GIF se for uma abertura
                     if (eventoLower.includes("abertura")) {
                        mostrarNotificacaoGIF(dados.tempo_aberto_ms || 5000);
                     }
                 }
             } else {
                 console.log("Nenhum dado de estado encontrado.");
                 const eventoEl = document.getElementById('evento');
                 if (eventoEl) { eventoEl.textContent = 'Sem dados'; eventoEl.style.color = 'var(--text-muted)'; }
             }
         }, (error) => {
             console.error('Erro ao buscar dados com onValue:', error);
             const eventoEl = document.getElementById('evento');
             if (eventoEl) { eventoEl.textContent = 'Erro de conexão'; eventoEl.style.color = 'var(--accent-red)'; }
         });
     }

     // --- FUNÇÕES DE INTERFACE (Adaptação para usar IDs e listeners) ---
    function mostrarAba(abaId) {
      document.querySelectorAll('.abaRelatorio').forEach(div => div.style.display = 'none');
      document.querySelectorAll('.abaBtn').forEach(btn => btn.classList.remove('ativo'));
      const abaSelecionada = document.getElementById(abaId);
      if(abaSelecionada) abaSelecionada.style.display = 'block';
      const btnSelecionado = document.querySelector(`.abaBtn[data-aba="${abaId}"]`);
      if(btnSelecionado) btnSelecionado.classList.add('ativo');
    }

    function alternarSobre() {
        const sobre = document.getElementById('sobreDashboard');
        const relatorio = document.getElementById('relatorioContainer');
        sobre.classList.toggle('mostrar');
        relatorio.classList.remove('mostrar'); // Garante que relatório esteja escondido

        if (sobre.classList.contains('mostrar')) {
            sobre.scrollIntoView({ behavior: 'smooth', block: 'start' });
            const secaoAtivaInicial = document.querySelector('#sobreDashboard .navegacao-secoes .btn-secao.ativo');
            mostrarSecao(secaoAtivaInicial ? secaoAtivaInicial.dataset.secao : 'prototipo');
        } else {
            deactivatePinnableSections();
            deactivateRequisitosObservers();
            requisitosScrollListenerActive = false;
        }
    }

    function alternarRelatorio() {
        const relatorio = document.getElementById('relatorioContainer');
        const sobre = document.getElementById('sobreDashboard');
        relatorio.classList.toggle('mostrar');

        if (relatorio.classList.contains('mostrar')) {
            sobre.classList.remove('mostrar'); // Esconde "Sobre"
            relatorio.scrollIntoView({ behavior: 'smooth', block: 'start' });
            deactivatePinnableSections(); // Desativa animações de "Sobre"
            deactivateRequisitosObservers();
            requisitosScrollListenerActive = false;
        } else if (sobre.classList.contains('mostrar')) {
            // Se "Sobre" já estava ativo, reativa suas animações
            const secaoAtivaInicial = document.querySelector('#sobreDashboard .navegacao-secoes .btn-secao.ativo');
            mostrarSecao(secaoAtivaInicial ? secaoAtivaInicial.dataset.secao : 'prototipo');
        }
    }


     // --- EVENT LISTENERS ---
     document.addEventListener('DOMContentLoaded', function() {
         // Notificações
         if ('Notification' in window && Notification.permission === 'default') {
             Notification.requestPermission();
         }

         // Animações e Scroll (seu código)
         initFrameScrollSystems();
         createPinnableObserver();
         for (let i = 1; i <= finalFramesCount; i++) new Image().src = `${baseUrlCaixa}(${i}).gif`;
         let tickingScroll = false;
         window.addEventListener('scroll', () => {
             if (!tickingScroll) {
                 requestAnimationFrame(() => {
                     handleGlobalScroll();
                     tickingScroll = false;
                 });
                 tickingScroll = true;
             }
         });
         window.addEventListener('resize', handleScroll);
         document.addEventListener('keydown', (e) => {
             if (e.key.toLowerCase() === 'd') {
                 const counter = document.getElementById('frameCounter');
                 counter.style.display = counter.style.display === 'none' ? 'block' : 'none';
             }
         });
         let konamiCode = []; const konami = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65];
         document.addEventListener('keydown', (e) => {
             konamiCode.push(e.keyCode); if (konamiCode.length > konami.length) konamiCode.shift();
             if (konamiCode.join(',') === konami.join(',')) { document.body.style.animation = 'rainbow 2s infinite'; setTimeout(() => { document.body.style.animation = ''; }, 10000); }
         });
         const cards = document.querySelectorAll('.card');
         cards.forEach((card, i) => {
             card.style.opacity = '0'; card.style.transform = 'translateY(30px)';
             setTimeout(() => { card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)'; card.style.opacity = '1'; card.style.transform = 'translateY(0)'; }, i * 200);
         });

         // Adiciona listeners aos botões com IDs
         document.getElementById('btnAbrirPorta').addEventListener('click', abrirPorta);
         document.getElementById('btnDefinirTempo').addEventListener('click', definirTempo);
         document.getElementById('btnVerRelatorio').addEventListener('click', alternarRelatorio);
         document.getElementById('btnSobreDashboard').addEventListener('click', alternarSobre);

         document.getElementById('btnAbaFirebase').addEventListener('click', () => mostrarAba('firebase'));
         document.getElementById('btnAbaBotao').addEventListener('click', () => mostrarAba('botao'));
         document.getElementById('btnAbaSensor').addEventListener('click', () => mostrarAba('sensor'));

         document.getElementById('btnSecaoPrototipo').addEventListener('click', () => mostrarSecao('prototipo'));
         document.getElementById('btnSecaoVersaoFinal').addEventListener('click', () => mostrarSecao('versaoFinal'));
         document.getElementById('btnSecaoRequisitos').addEventListener('click', () => mostrarSecao('requisitos'));

         // Carrega estado inicial e começa a ouvir o Firebase
         document.getElementById('relatorioContainer').classList.remove('mostrar');
         document.getElementById('sobreDashboard').classList.add('mostrar');
         mostrarSecao('prototipo');
         mostrarAba('firebase');
         finalImageElement.style.opacity = 0;
         finalTextOverlay.style.opacity = 0;

         // INICIA OUVINTE DO FIREBASE PARA ESTADO
         ouvirDadosEstado();
         // CARREGA OS RELATÓRIOS SALVOS
         carregarTodosRelatorios();

     });

     // --- CÓDIGOS FINAIS (Service Worker, Estilos) ---
     if ('serviceWorker' in navigator) navigator.serviceWorker.register('data:text/javascript,').catch(() => {});
     const style = document.createElement('style');
     style.textContent = `
       @keyframes rainbow { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }
       @keyframes glow { 0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.3); } 50% { box-shadow: 0 0 40px rgba(0, 255, 136, 0.8); } }
       .card:hover::after { content: ''; position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; border-radius: 26px; z-index: -1; animation: glow 2s ease-in-out infinite; }
     `;
     document.head.appendChild(style);

  </script>
</body>
</html>
