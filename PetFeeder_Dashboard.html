<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard PetFeeder</title>
  <style>


    :root {
      --bg-ios: #1c1c1e;
      --card-ios: #2c2c2e;
      --text-ios: #f2f2f7;
      --accent-ios: #8e8e93;
      --button-ios: #3a3a3c;
      --scrollbar-thumb: #5c5c5c;
      --scrollbar-track: #2c2c2e;
    }

    * {
      box-sizing: border-box;
      transition: all 0.3s ease;
    }

    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;

      background: var(--bg-ios);
      color: var(--text-ios);
    }

    header {
      background: var(--card-ios);
      color: var(--text-ios);
      padding: 1rem 2rem;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    }

    .abaBtn.ativo {
      background-color: #30d158; /* iOS-style green */
      color: #fff;
    }

    


    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      padding: 2rem;
    }

    .card {
      background: var(--card-ios);
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      padding: 1.5rem;
    }

    .card h3 {
      margin-bottom: 1rem;
      color: var(--text-ios);
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    button {
      padding: 0.75rem;
      font-size: 1rem;
      border-radius: 12px;
      border: none;
      background-color: var(--button-ios);
      color: var(--text-ios);
      cursor: pointer;
      width: 100%;
    }

    .abaBtn {
      padding: 0.75rem;
      font-size: 1rem;
      border-radius: 12px;
      border: none;
      background: var(--button-ios);
      color: var(--text-ios);
      flex: 1;
    }

    .abaBtn:hover,
    button:hover {
      background-color: #48484a;
    }

    #tempoLabel {
      text-align: center;
      margin-top: 0.5rem;
      font-size: 1rem;
    }

    input[type="range"] {
      width: 100%;
    }

    #relatorioContainer {
      grid-column: span 2;
      background: var(--card-ios);
      border-radius: 16px;
      padding: 1.5rem;
      display: none;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s ease;
    }

    #relatorioContainer.mostrar {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .relatorioItem {
      background: #3a3a3c;
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 12px;
      animation: fadeIn 0.6s ease-in;
    }

    .abaRelatorio {
      display: none;
    }

    .abaBtns-container {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    #sobreDashboard {
      display: none;
      grid-column: span 1; /* Ocupa uma √∫nica coluna */
      background: var(--card-ios);
      border-radius: 16px;
      padding: 0;
      height: 228px; /* Mantido conforme seu pedido */
      display: flex;
      flex-direction: row;
      overflow: hidden;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s ease;
      width: 100%;      /* Ocupa 100% da coluna */
      max-width: 100%;  /* Garante que n√£o ultrapasse */
    }



    #sobreDashboard.mostrar {
      display: flex;
      opacity: 1;
      transform: translateY(0);
    }

    .scrollSyncWrapper {
      display: flex;
      width: 100%;
      height: 100%;
    }

    .sobreTextoBox {
      width: 50%;
      height: 100%;
      background: #3a3a3c;
      border-radius: 16px 0 0 16px;
      padding: 1rem;
      overflow-y: auto;
      position: relative; /* Necess√°rio para posicionar o gradiente interno */
    }

    .sobreTextoBox h4 {
      margin-top: 0;
      font-size: 1.4rem; /* T√≠tulo maior */
    }

    .sobreTextoBox p {
      font-size: 1.1rem; /* Texto maior para exigir scroll mesmo com texto menor */
      line-height: 1.6;
    }

    /* Fade na parte inferior para indicar scroll */
    


    #scrollGifContainer {
      width: 50%;
      height: 100%;
      overflow-y: auto;
      background: #2c2c2e;
      border-radius: 0 16px 16px 0;
      padding: 1rem 1rem 1rem 0.5rem; /* menos padding √† esquerda */
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    #scrollGif {
      max-width: 95%; /* n√£o encosta na barra */
      max-height: 180px;
      border-radius: 10px;
      border: 1px solid #444;
    }


    .sobreTextoBox::-webkit-scrollbar,
    #scrollGifContainer::-webkit-scrollbar {
      width: 8px;
    }

    .sobreTextoBox::-webkit-scrollbar-thumb,
    #scrollGifContainer::-webkit-scrollbar-thumb {
      background-color: var(--scrollbar-thumb);
      border-radius: 4px;
    }

    .sobreTextoBox::-webkit-scrollbar-track,
    #scrollGifContainer::-webkit-scrollbar-track {
      background-color: var(--scrollbar-track);
    }

    @media (max-width: 768px) {
      #sobreDashboard {
        flex-direction: column;
        width: 100%;
        height: auto;
      }

      .scrollSyncWrapper {
        flex-direction: column;
      }

      .sobreTextoBox,
      #scrollGifContainer {
        width: 100%;
        height: 200px;
        border-radius: 12px;
      }
    }
  
.sobreTextoBox p {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.6s ease-out, transform 0.6s ease-out;
}

.sobreTextoBox p.visible {
  opacity: 1;
  transform: translateY(0);
}

</style>
</head>
<body>
  <header>
    <h1>Dashboard PetFeeder</h1>
  </header>

  <div class="container">
    <div class="card"> 
      <h3>Controle Remoto</h3>
      <div class="controls">
        <button onclick="abrirPorta()">Abrir PetFeeder</button>
        <label for="tempoRange">‚è±Ô∏è Tempo de Abertura (ms)</label>
        <input type="range" id="tempoRange" min="1000" max="10000" step="1000" value="5000">
        <div id="tempoLabel">5000 ms</div>
        <button onclick="definirTempo()">Definir Tempo</button>
        <div style="display: flex; gap: 1rem;">
          <button onclick="alternarRelatorio()" class="abaBtn">üìÑ Ver Relat√≥rio</button>
          <button onclick="alternarSobre()" class="abaBtn">‚ÑπÔ∏è Sobre o Dashboard</button>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>√öltimos Dados</h3>
      <p><strong>Dist√¢ncia:</strong> <span id="distancia">--</span> cm</p>
      <p><strong>Potenci√¥metro:</strong> <span id="pot">--</span></p>
      <p><strong>Tempo Abertura:</strong> <span id="tempo">--</span> ms</p>
      <p><strong>Modo:</strong> <span id="modo">--</span></p>
      <p><strong>Evento:</strong> <span id="evento">--</span></p>
    </div>

    <div id="relatorioContainer">
      <h3>üìä Relat√≥rios Gerados</h3>
      <div class="abaBtns-container">
        <button onclick="mostrarAba('firebase')" class="abaBtn" data-aba="firebase">üåê Firebase</button>
        <button onclick="mostrarAba('botao')" class="abaBtn" data-aba="botao">üñ±Ô∏è Bot√£o</button>
        <button onclick="mostrarAba('sensor')" class="abaBtn" data-aba="sensor">üì° Sensor</button>
      </div>

      <div id="firebase" class="abaRelatorio"></div>
      <div id="botao" class="abaRelatorio"></div>
      <div id="sensor" class="abaRelatorio"></div>
    </div>

    <div id="sobreDashboard">
    <div class="scrollSyncWrapper">
      <div class="sobreTextoBox" id="syncTexto">
        <h4>Prot√≥tipo</h4>
        <p>
          O foco do projeto foi cumprir os requisitos da disciplina de Sistemas Embarcados. Come√ßamos com um sensor PIR, mas trocamos por um ultrass√¥nico mais preciso. O potenci√¥metro controla a quantidade de ra√ß√£o, e um LED indica a abertura do alimentador. Enfrentamos problemas com fios defeituosos e um curto inicial, o que refor√ßou a import√¢ncia da organiza√ß√£o. Finalizamos com a integra√ß√£o do Firebase para controle remoto e registro dos dados.
        </p>
       
      </div>
      <div id="scrollGifContainer">
        <img id="scrollGif" src="frames/frame (1).gif" alt="gif" />
      </div>
    </div>
  </div>

  <script>
    const firebaseUrl = "https://petfeed-se-default-rtdb.firebaseio.com/";
    let ultimoEvento = null;

    document.getElementById("tempoRange").addEventListener("input", function () {
      document.getElementById("tempoLabel").textContent = `${this.value} ms`;
    });

    async function abrirPorta() {
      await fetch(firebaseUrl + "comando/abrir.json", {
        method: "PUT",
        body: "true"
      });
      alert("‚úÖ PetFeeder ser√° aberto");
    }

    async function definirTempo() {
      const tempo = parseInt(document.getElementById("tempoRange").value);
      await fetch(firebaseUrl + "comando/tempo_remoto_ms.json", {
        method: "PUT",
        body: tempo.toString()
      });
      alert(`‚úÖ Tempo definido: ${tempo} ms`);
    }

    function atualizarDashboard(dados) {
      document.getElementById('distancia').textContent = dados.distancia_cm;
      document.getElementById('pot').textContent = dados.potenciometro;
      document.getElementById('tempo').textContent = dados.tempo_aberto_ms;
      document.getElementById('modo').textContent = dados.modo;
      document.getElementById('evento').textContent = dados.evento;
    }

    async function fetchDados() {
      const res = await fetch(firebaseUrl + "estado.json");
      const dados = await res.json();

      atualizarDashboard(dados);

      const evento = (dados.evento || "").toLowerCase();
      if (evento !== ultimoEvento) {
        ultimoEvento = evento;
        gerarRelatorioComDados(dados);
      }

      return dados;
    }

    function mostrarAba(abaId) {
      // Oculta todas as abas
      document.querySelectorAll('.abaRelatorio').forEach(div => {
        div.style.display = 'none';
      });

      // Remove destaque de todos os bot√µes
      document.querySelectorAll('.abaBtn').forEach(btn => {
        btn.classList.remove('ativo');
      });

      // Mostra a aba clicada
      const abaSelecionada = document.getElementById(abaId);
      if (abaSelecionada) {
        abaSelecionada.style.display = 'block';
      }

      // Adiciona destaque ao bot√£o correto via data-aba
      const botaoSelecionado = document.querySelector(`.abaBtn[data-aba="${abaId}"]`);
      if (botaoSelecionado) {
        botaoSelecionado.classList.add('ativo');
      }
    }


    function alternarSobre() {
      const sobre = document.getElementById('sobreDashboard');
      const relatorio = document.getElementById('relatorioContainer');
      sobre.classList.toggle('mostrar');
      relatorio.classList.remove('mostrar');
      if (sobre.classList.contains('mostrar')) {
        sobre.scrollIntoView({ behavior: 'smooth' });
      }
    }

    function alternarRelatorio() {
      const relatorio = document.getElementById('relatorioContainer');
      const sobre = document.getElementById('sobreDashboard');
      relatorio.classList.toggle('mostrar');
      sobre.classList.remove('mostrar');
      if (relatorio.classList.contains('mostrar')) {
        relatorio.scrollIntoView({ behavior: 'smooth' });
      }
    }

    function gerarRelatorioComDados(dados) {
      const evento = dados.evento?.toLowerCase() || "";
      let aba = "";

      if (evento.includes("firebase")) aba = "firebase";
      else if (evento.includes("bot√£o") || evento.includes("botao")) aba = "botao";
      else if (evento.includes("sensor")) aba = "sensor";
      else return;

      const container = document.getElementById(aba);
      const novoItem = document.createElement("div");
      novoItem.classList.add("relatorioItem");
      novoItem.innerHTML = `
        <ul>
          <li><strong>Data:</strong> ${new Date().toLocaleString()}</li>
          <li><strong>Dist√¢ncia:</strong> ${dados.distancia_cm} cm</li>
          <li><strong>Potenci√¥metro:</strong> ${dados.potenciometro}</li>
          <li><strong>Tempo de Abertura:</strong> ${dados.tempo_aberto_ms} ms</li>
          <li><strong>Modo:</strong> ${dados.modo}</li>
          <li><strong>Evento:</strong> ${dados.evento}</li>
        </ul>
      `;
      container.prepend(novoItem);
    }

    async function gerarRelatorio() {
      const dados = await fetchDados();
      gerarRelatorioComDados(dados);
    }

    setInterval(fetchDados, 2000);

    // Scroll sincronizado + gif animado por scroll
    const gif = document.getElementById("scrollGif");
    const totalFrames = 37;

    const scrollTexto = document.querySelector(".sobreTextoBox");
    const scrollGifContainer = document.getElementById("scrollGifContainer");

    function syncScroll(e) {
      const source = e.target;
      const target = source === scrollTexto ? scrollGifContainer : scrollTexto;

      target.scrollTop = source.scrollTop;

      const percent = source.scrollTop / (source.scrollHeight - source.clientHeight);
      const frameIndex = Math.min(totalFrames - 1, Math.floor(percent * totalFrames));
      gif.src = `frames/frame (${frameIndex + 1}).gif`;
    }

    function toggleFadeEffect() {
      const fade = document.getElementById("fadeEffect");
      const scrollable = scrollTexto;

      const atBottom = scrollable.scrollTop + scrollable.clientHeight >= scrollable.scrollHeight - 1;
      if (atBottom) {
        fade.classList.add("hidden");
      } else {
        fade.classList.remove("hidden");
      }
    }


    scrollTexto.addEventListener("scroll", (event) => {
      syncScroll(event);
      toggleFadeEffect(); // mostra ou esconde o blur
    });

    scrollGifContainer.addEventListener("scroll", syncScroll);
    window.addEventListener("load", toggleFadeEffect);
  



// Anima√ß√£o de fade-in com IntersectionObserver
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add("visible");
    }
  });
}, {
  root: scrollTexto,
  threshold: 0.1
});

document.querySelectorAll('.sobreTextoBox p').forEach(p => {
  observer.observe(p);
});

</script>
</body>
</html>

